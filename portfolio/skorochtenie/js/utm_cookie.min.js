//
// Author: Puru Choudhary (www.terminusapp.com)
// URL: https://github.com/medius/utm_cookie
//
// Description:
// This script saves UTM parameters in cookies whenever there are any UTM parameters
// in the URL. It also saves the initial referrer information in a cookie which is
// never (365 days) overwritten.
//
// Adding this script is useful for custom tracking. e.g. The values in the cookies
// can be read and added to forms or stored in the backend database, etc.
//
var utmCookie = {
    cookieNamePrefix: "",
    utmParams: ["utm_source", "utm_medium", "utm_campaign", "utm_term", "utm_content"],
    cookieExpiryDays: 365,
    createCookie: function (c, d, e) {
        if (e) {
            var b = new Date();
            b.setTime(b.getTime() + (e * 24 * 60 * 60 * 1000));
            var a = "; expires=" + b.toGMTString()
        } else {
            var a = ""
        }
        document.cookie = this.cookieNamePrefix + c + "=" + d + a + "; path=/"
    },
    readCookie: function (b) {
        var e = this.cookieNamePrefix + b + "=";
        var a = document.cookie.split(";");
        for (var d = 0; d < a.length; d++) {
            var f = a[d];
            while (f.charAt(0) == " ") {
                f = f.substring(1, f.length)
            }
            if (f.indexOf(e) == 0) {
                return f.substring(e.length, f.length)
            }
        }
        return null
    },
    eraseCookie: function (a) {
        this.createCookie(a, "", -1)
    },
    getParameterByName: function (b) {
        b = b.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var a = "[\\?&]" + b + "=([^&#]*)";
        var d = new RegExp(a);
        var c = d.exec(window.location.search);
        if (c == null) {
            return ""
        } else {
            return decodeURIComponent(c[1].replace(/\+/g, " "))
        }
    },
    utmPresentInUrl: function () {
        var d = false;
        for (var a = 0; a < this.utmParams.length; a++) {
            var c = this.utmParams[a];
            var b = this.getParameterByName(c);
            if (b != "" && b != undefined) {
                d = true
            }
        }
        return d
    },
    writeUtmCookieFromParams: function () {
        for (var a = 0; a < this.utmParams.length; a++) {
            var c = this.utmParams[a];
            var b = this.getParameterByName(c);
            this.createCookie(c, b, this.cookieExpiryDays)
        }
    },
    writeCookieOnce: function (a, c) {
        var b = this.readCookie(a);
        if (!b) {
            this.createCookie(a, c, this.cookieExpiryDays)
        }
    },
    writeReferrerOnce: function () {
        value = document.referrer;
        if (value === "" || value === undefined) {
            this.writeCookieOnce("referrer", "direct")
        } else {
            this.writeCookieOnce("referrer", value)
        }
    },
    referrer: function () {
        return this.readCookie("referrer")
    }
};
utmCookie.writeReferrerOnce();
if (utmCookie.utmPresentInUrl()) {
    utmCookie.writeUtmCookieFromParams()
}
;
